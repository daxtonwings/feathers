
## 从计算机原理开始


> 进程是操作系统对正在运行的程序的抽象。一个操作系统上可以同时运行多个进程，而每个进程都好像独占的使用硬件资源。并发运行，则是说一个进程的指令和另一个进程的指令是交错执行的。无论是单核还是多核系统中，一个CPU看上去都像是在并发的执行多个进程，这是通过处理器在进程间切换来实现的。操作系统实现这种交错执行的机制称为“上下文切换”
> 
> 上下文包括许多信息，比如PC(程序计数器)和CPU寄存器, 以及主存储器的内容。当操作系统决定要抱控制权从当前进程转移到另一个进程时，就会进行“上下文切换”。
>
> --- 「Compute System」


从一个进程到另一个进程的转换是有操作系统内核(kernel)管理的。当应用程序执行系统调用(system call)指令时，比如读写文件，将控制权传递给内核。然后内核执行被请求的操作并返回应用程序。

术语并发(concurrency)，指一个同事具有多个活动的系统；术语并行(parallelism)指用并发来使一个系统运行的更快。

1. 线程级并发：传统意义上，这种并发只是模拟出来的，处理器必须在多个任务间切换；超线程，允许CPU执行多个控制流，在CPU等待数据装载到高速缓存前可以继续执行其他协程，例如一个4核处理器实际可以并行8个线程
2. 指令集并发：现代处理器利用流水线方式，可以同时执行多条指令。
3. 单指令多数据并发：一条指令产生多个并行操作

虚拟内存是一个抽象概念，它为每个进程提供了一个假象，即每个进程独占的使用主存。每个进程看到的内存是一致的，称为虚拟地址空间。以Linux为例地址空间从大到小包括：
- 内核
- 用户栈（从大到小增长）
- 共享库内存（从小到大增长）
- 运行时堆（小小到大增长）
- 用户程序读/写数据
- 用户程序只读代码与数据




面向对象编程、范型编程是高级语言的开发模式

在机器底层，指令语句组合形成的首层抽象单元是“过程”，根据一组参数实现某种功能再可选的返回一个返回值。

当发生过程调用时，通常伴随着栈指针的变化。通过移动栈指针，为新的过程所需的变量在栈内存空间上分配内存空间，并在过程结束时释放这些空间。

“程序计数器”PC指向的是机器当前执行的指令位置。当发生过程调用命令`call Q`时，首先将返回指令地址(即`call Q`的下一条指令)压入栈中, 接着将PC设置为过程Q的起始指令位置开始执行。当过程Q执行完毕时，过程Q的栈帧先清理，再从栈中弹出过程P的返回指令地址，继续执行过程P


## 异步与协程

I/O阻塞对异步的需求
独立计算的并行需求

协程，应用代码交换执行片段

## yield与Generator

Python的Generator语法
```python
def g():
    i = 1
    yield i
    i += 1

a = g()  # a is a generator
next(a)  # out 1
next(a)  # raise StopIteration
```

- `a=g()`为协程内变量准备储存空间
- `yield`表示函数主动让出执行条件，保存当前状态
- `next(a)`: 第一次为进入协程，第二次为继续运行